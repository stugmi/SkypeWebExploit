#!/usr/bin/python
import requests
import json
import sys

ass = requests.session()

token = "" #  get it from the headers

def main():
    try:
        response = ass.post(
            url='https://client-s.gateway.messenger.live.com/v1/users/ME/conversations/19:' + sys.argv[1] + '/messages',
            data=json.dumps({"content":sys.argv[3],
                  "messagetype":"RichText", 
                  "contenttype":"text",
                  "skypeeditedid":sys.argv[2]
                  }),
            headers={"RegistrationToken": token ,
                      "Content-Type":"application/json; charset=utf-8",
                      "ContextId":"tcid="+sys.argv[2]})
    except Exception as e:
        print("Error uploading {0}".format(e))
        print "Usage: ./{} <user> <id> <message>".format(sys.argv[0])
        exit()
    else:
        print(response.text)

if __name__ == '__main__':
  main()
